<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스네이크 게임</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }
        canvas {
            background-color: #000;
            display: block;
            border: 2px solid #333;
        }
        #message {
            position: absolute;
            top: 20px;
            color: #333;
            font-size: 24px;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas" width="600" height="600"></canvas>
<div id="message">스페이스바를 눌러 시작하세요!</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const box = 20; // 뱀의 한 칸 크기 및 음식 크기
    let snake = [{x: 10 * box, y: 10 * box}];
    let food = {x: Math.floor(Math.random() * 30) * box, y: Math.floor(Math.random() * 30) * box};
    let direction = "";
    let gameRunning = false;
    let score = 0;

    // 장애물 배열 (고정된 위치)
    const obstacles = [
        {x: 15 * box, y: 15 * box},
        {x: 20 * box, y: 20 * box},
        {x: 25 * box, y: 25 * box},
        {x: 30 * box, y: 10 * box}
    ];

    // 키 입력 이벤트 리스너
    document.addEventListener('keydown', event => {
        if (event.code === 'Space') {
            startGame();
        }
        if (event.key === 'w' && direction !== 'DOWN') direction = 'UP';
        if (event.key === 's' && direction !== 'UP') direction = 'DOWN';
        if (event.key === 'a' && direction !== 'RIGHT') direction = 'LEFT';
        if (event.key === 'd' && direction !== 'LEFT') direction = 'RIGHT';
    });

    // 게임 시작 또는 재시작 함수
    function startGame() {
        if (!gameRunning) {
            gameRunning = true;
            document.getElementById('message').innerText = "";
            direction = getRandomDirection();
            snake = [{x: 10 * box, y: 10 * box}];
            score = 0;
            food = {x: Math.floor(Math.random() * 30) * box, y: Math.floor(Math.random() * 30) * box};
            gameLoop();
        }
    }

    // 뱀이 처음 움직일 방향을 무작위로 설정
    function getRandomDirection() {
        const directions = ['UP', 'DOWN', 'LEFT', 'RIGHT'];
        return directions[Math.floor(Math.random() * directions.length)];
    }

    // 메인 게임 루프
    function gameLoop() {
        if (!gameRunning) return;

        // 캔버스 초기화
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 음식 그리기
        ctx.fillStyle = 'red';
        ctx.fillRect(food.x, food.y, box, box);

        // 장애물 그리기
        ctx.fillStyle = 'grey';
        for (let obstacle of obstacles) {
            ctx.fillRect(obstacle.x, obstacle.y, box, box);
        }

        // 뱀 움직이기
        let headX = snake[0].x;
        let headY = snake[0].y;

        if (direction === 'UP') headY -= box;
        if (direction === 'DOWN') headY += box;
        if (direction === 'LEFT') headX -= box;
        if (direction === 'RIGHT') headX += box;

        // 벽에 충돌했는지 확인
        if (headX < 0 || headY < 0 || headX >= canvas.width || headY >= canvas.height || collision(headX, headY) || checkObstacleCollision(headX, headY)) {
            gameOver();
            return;
        }

        // 뱀이 음식을 먹었는지 확인
        if (headX === food.x && headY === food.y) {
            score++;
            food = {x: Math.floor(Math.random() * 30) * box, y: Math.floor(Math.random() * 30) * box};
        } else {
            snake.pop(); // 꼬리 제거
        }

        // 새로운 머리 위치 추가
        snake.unshift({x: headX, y: headY});

        // 뱀 그리기
        for (let i = 0; i < snake.length; i++) {
            ctx.fillStyle = i === 0 ? 'lime' : 'green'; // 머리는 연두색, 몸통은 초록색
            ctx.fillRect(snake[i].x, snake[i].y, box, box);

            // 머리에 눈 그리기 (첫 번째 블록이 머리)
            if (i === 0) {
                drawEyes(snake[i].x, snake[i].y, direction);
            }
        }

        setTimeout(gameLoop, 100);
    }

    // 뱀 머리에 눈 그리기
    function drawEyes(headX, headY, direction) {
        ctx.fillStyle = 'white';
        let eyeOffsetX = 0;
        let eyeOffsetY = 0;

        if (direction === 'UP') {
            eyeOffsetY = -box / 4;
            ctx.beginPath();
            ctx.arc(headX + box / 4, headY + eyeOffsetY, box / 6, 0, Math.PI * 2);
            ctx.arc(headX + 3 * box / 4, headY + eyeOffsetY, box / 6, 0, Math.PI * 2);
        } else if (direction === 'DOWN') {
            eyeOffsetY = box / 4;
            ctx.beginPath();
            ctx.arc(headX + box / 4, headY + box + eyeOffsetY, box / 6, 0, Math.PI * 2);
            ctx.arc(headX + 3 * box / 4, headY + box + eyeOffsetY, box / 6, 0, Math.PI * 2);
        } else if (direction === 'LEFT') {
            eyeOffsetX = -box / 4;
            ctx.beginPath();
            ctx.arc(headX + eyeOffsetX, headY + box / 4, box / 6, 0, Math.PI * 2);
            ctx.arc(headX + eyeOffsetX, headY + 3 * box / 4, box / 6, 0, Math.PI * 2);
        } else if (direction === 'RIGHT') {
            eyeOffsetX = box / 4;
            ctx.beginPath();
            ctx.arc(headX + box + eyeOffsetX, headY + box / 4, box / 6, 0, Math.PI * 2);
            ctx.arc(headX + box + eyeOffsetX, headY + 3 * box / 4, box / 6, 0, Math.PI * 2);
        }

        ctx.fill();
    }

    // 장애물과 충돌했는지 확인
    function checkObstacleCollision(x, y) {
        for (let obstacle of obstacles) {
            if (x === obstacle.x && y === obstacle.y) {
                return true;
            }
        }
        return false;
    }

    // 뱀이 자신과 충돌했는지 확인
    function collision(x, y) {
        for (let segment of snake) {
            if (segment.x === x && segment.y === y) {
                return true;
            }
        }
        return false;
    }

    // 게임 오버 함수
    function gameOver() {
        gameRunning = false;
        document.getElementById('message').innerText = `게임 오버! 스페이스바를 눌러 재시작하세요. 점수: ${score}`;
    }
</script>

</body>
</html>
